<!DOCTYPE html>
<html lang="en">
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Login Page - AdZU SHS Digital Archive</title> 
  <link rel="stylesheet" href="loginstyle.css"> 
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="database.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head> 
<body> 

<header>
    <div class="header-left">
        <div class="imgL">
            <img src="Photos/shs_logo.png" alt="shs" class="shslogo">
        </div>
        <div id="Header_Head">
            <a href="main.html" class="shsP">ADZU SHS Research Hub</a>
        </div>
    </div>
    <div class="img">
        <img src="Photos/main_logo.png" alt="ADZU Logo">   
    </div>
</header> 

<!-- Login Section -->
<section class="login-section" id="login"> 
  <div class="container"> 
    <h2>LOGIN</h2> 
    <form id="login-form" onsubmit="validateLogin(); return false;"> 
      <div class="input-group"> 
        <label for="email">Email</label> 
        <input type="email" id="email" class="input" placeholder="Enter your email" required> 
      </div> 
      <div class="input-group"> 
        <label for="password">Password</label> 
        <input type="password" id="password" class="input" placeholder="Enter your password" required> 
      </div> 
      <button type="submit" class="login-button">Login</button> 
      
      <!-- Google Sign-In Button -->
      <div class="google-login-section">
        <div id="g_id_onload"
             data-client_id="YOUR_GOOGLE_CLIENT_ID"
             data-callback="handleGoogleSignIn">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
      </div>
      
      <div class="register-section"> 
        <span>Don't have an account?</span> 
        <a href="#" onclick="toggleForms(); return false;">Sign in with Google</a> 
      </div>
      
      <div class="guest-section"> 
        <span>Not an ADZU member? View as a <a href="main.html" class="guest-link">guest</a></span> 
      </div> 
      

    </form> 
  </div> 
</section> 

<!-- Google Account Section -->
<section class="login-section" id="google-register" style="display: none;"> 
  <div class="container"> 
    <h2>Sign in with Google</h2> 
    <div class="google-signin-container">
      <div id="g_id_onload_register"
           data-client_id="YOUR_GOOGLE_CLIENT_ID"
           data-callback="handleGoogleSignIn">
      </div>
      <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left"></div>
    </div>
    <div class="register-section"> 
      <span>Already have an account?</span>
      <a href="#" onclick="toggleForms(); return false;">Login</a>
    </div>
    <!-- Guest Access Section -->
    <div class="guest-section">
      <span>Not an ADZU member? View as a <a href="main.html" class="guest-link">guest</a></span>
    </div>
  </div> 
</section> 

<script> 
  async function validateLogin() { 
    const emailInput = document.getElementById("email").value; 
    const passwordInput = document.getElementById("password").value; 

    try {
      const result = await database.loginUser(emailInput, passwordInput);
      alert(result.message);
      window.location.href = "upload.html";
    } catch (error) {
      alert(error.message);
    }
  } 

  function handleGoogleSignIn(response) {
    // Decode the JWT token
    const responsePayload = decodeJwtResponse(response.credential);
    
    console.log("ID: " + responsePayload.sub);
    console.log('Full Name: ' + responsePayload.name);
    console.log('Given Name: ' + responsePayload.given_name);
    console.log('Family Name: ' + responsePayload.family_name);
    console.log("Image URL: " + responsePayload.picture);
    console.log("Email: " + responsePayload.email);
    
    // Here you would typically send this data to your backend
    // For now, we'll just redirect to upload.html
    alert("Successfully signed in with Google!");
    window.location.href = "upload.html";
  }

  function decodeJwtResponse(token) {
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
  }

  function toggleForms() {
    const loginSection = document.getElementById("login");
    const googleRegisterSection = document.getElementById("google-register");
    
    if (loginSection.style.display === "none") {
      loginSection.style.display = "flex";
      googleRegisterSection.style.display = "none";
    } else {
      loginSection.style.display = "none";
      googleRegisterSection.style.display = "flex";
    }
  }
</script> 

</body> 
</html>
